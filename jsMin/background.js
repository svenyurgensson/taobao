function sendRequest(n,a){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&200===e.status&&a(e.responseText)},e.open("GET",n,!0),e.send()}function dataCollection(n,a){if(n=new Function("function $callback(obj){return obj};function jsonp_reviews_list(obj){return obj;}function __jsonp_records_reload(obj){return obj;};return "+n.trim())(),"string"==typeof a?displayInfo.successRate=(n.quantity.paySuccessItems/(n.quantity.paySuccessItems+n.quantity.confirmGoodsItems)*100).toFixed(2):a.push(n),h++,13==h){var e=0,o=0;displayInfo.anonyCommentsRate=0;var t=0,i=0;displayInfo.anonyTradeRate=0,console.log(infoGroup);for(var s=0;5>s;s++){var p=infoGroup.commentList[s].comments,l=p&&p.length;e+=l||0;for(var r=0;l>r;r++)JSON.parse(p[r].user.anony)&&o++;var u=infoGroup.tradeDetailList[s].html,d=new RegExp(/tb-buyer/g);~u.indexOf("tb-buyer")&&(t+=u.match(d)?u.match(d).length:0,i+=u.match(new RegExp(/匿名/g))?u.match(new RegExp(/匿名/g)).length:0)}displayInfo.anonyCommentsRate=(o/e*100).toFixed(2),displayInfo.anonyTradeRate=(i/t*100).toFixed(2)}}function shopInfoBundle(n){var a=n.indexOf('id="J_showShopStartDate"'),e=n.slice(a,n.indexOf("/>",a));displayInfo.shopStartDate=e.match(new RegExp(/[0-9\-]{4,}/g))[0];var o=new RegExp(/id="monthuserid"\svalue="(.*)(?=")/),t="http://rate.taobao.com/ShopService4C.htm?userNumId="+o.exec(n)[1].trim()+"&shopID="+apiGroup.g_con.shopId+"&isB2C=false";sendRequest(t,function(n){var a=JSON.parse(n);displayInfo.ratRefund={},displayInfo.complaints={},displayInfo.punish={};var e=a.ratRefund,o=a.complaints,t=a.punish;displayInfo.ratRefund.refundCount=e.refundCount,displayInfo.ratRefund.danger=+e.indVal-+e.localVal<=0?!0:!1,displayInfo.ratRefund.localVal=e.localVal,displayInfo.complaints.disputRefundNum=o.disputRefundNum,displayInfo.complaints.danger=+o.indVal-+o.localVal<=0?!0:!1,displayInfo.complaints.localVal=o.localVal,displayInfo.punish.punishCount=t.punishCount,displayInfo.punish.cPunishTimes=t.cPunishTimes,displayInfo.punish.danger=+t.indVal-+t.localVal<0?!0:!1,displayInfo.punish.localVal=t.localVal})}var apiGroup={},infoGroup={},displayInfo={},h=0;chrome.extension.onRequest.addListener(function(n){switch(n.cmd){case"get-basicInfo":h=0,apiGroup=n,infoGroup.commentList=[],infoGroup.badCommentList=[],infoGroup.normalCommentList=[],infoGroup.tradeDetailList=[],displayInfo.successRate="",function(){for(var n=1;6>n;n++)sendRequest(apiGroup.dataListApi+"&callback=jsonp_reviews_list&currentPageNum="+n,function(n){dataCollection(n,infoGroup.commentList)}),sendRequest(apiGroup.dataApi.replace(/&bid_page=[0-9]*/,"")+"&callback=__jsonp_records_reload&bid_page="+n,function(n){dataCollection(n,infoGroup.tradeDetailList)})}(),sendRequest(apiGroup.dataListApi+"&callback=jsonp_reviews_list&currentPageNum=1&rateType=0",function(n){dataCollection(n,infoGroup.normalCommentList)}),sendRequest(apiGroup.dataListApi+"&callback=jsonp_reviews_list&currentPageNum=1&rateType=-1",function(n){dataCollection(n,infoGroup.badCommentList)}),sendRequest(apiGroup.apiItemInfo,function(n){dataCollection(n,displayInfo.successRate)}),sendRequest(apiGroup.dataRateUrl,shopInfoBundle)}});var shopDataDetail={};